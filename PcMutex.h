#include <pthread.h>

#ifndef mutex_h
#define mutex_h

//-----------------------------------------------------------------------------------------
// PcMutex (Priority Ceiling Mutex) class definition and implementation.
// Works as a wrapper around standard pthread_mutex functions.
//-----------------------------------------------------------------------------------------
class PcMutex
{
	//-----------------------------------------------------------------------------------------
	// Public members
	//-----------------------------------------------------------------------------------------
	public:
		//-----------------------------------------------------------------------------------------
		// Constructor (initializes PC mutex)
		//-----------------------------------------------------------------------------------------
		PcMutex()
		{
			printf("Initializing PC mutex ...\n");
			pthread_mutex_init(&pcMutex, NULL);
		}

		//-----------------------------------------------------------------------------------------
		// Destructor
		//-----------------------------------------------------------------------------------------
		virtual ~PcMutex()
		{
			printf("Destroying PC mutex ...\n");
			int status = pthread_mutex_destroy(&pcMutex);
			if (status != 0)
				printf("Error destroying PC mutex");
		}

		//-----------------------------------------------------------------------------------------
		// Locks PC mutex, returns 0 (success) or error code (failure).
		//-----------------------------------------------------------------------------------------
		int lock()
		{
			return pthread_mutex_lock(&pcMutex);
		}

		//-----------------------------------------------------------------------------------------
		// Unlocks PC mutex, returns 0 (success) or error code (failure).
		//-----------------------------------------------------------------------------------------
		int unlock()
		{
			return pthread_mutex_unlock(&pcMutex);
		}

	//-----------------------------------------------------------------------------------------
	// Private members
	//-----------------------------------------------------------------------------------------
	private:
		pthread_mutex_t  pcMutex;
};

#endif
